---
import Icon from "../../elements/icon/icon.astro";

const {
  name,
  options = [],
  title,
  required = false,
  iconOnly = false,
  multiple = false,
  class: className,
  ...rest
} = Astro.props;

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(([key]) => !key.startsWith("_"))
);

const groupId = htmlAttributes.id || `segments-${crypto.randomUUID()}`;
const inputType = multiple ? "checkbox" : "radio";
---

<fieldset
  class:list={["segments", iconOnly && "icon-only", multiple && "multiple", className]}
  role={multiple ? "group" : "radiogroup"}
  aria-labelledby={title ? `${groupId}-legend` : undefined}
  {...htmlAttributes}
>
  {
    title && (
      <legend id={`${groupId}-legend`} class="legend">
        {title}
        {required && (
          <span class="required" aria-label="required">
            *
          </span>
        )}
      </legend>
    )
  }
  <div class="options" role="presentation">
    {
      options.map((option, index) => (
        <label class="option">
          <input
            type={inputType}
            name={multiple ? `${name}[]` : name}
            value={option.value}
            checked={option.checked || false}
            required={required && index === 0}
            aria-required={required && index === 0}
            class="field"
          />
          <span
            class="segment"
            role="button"
            tabindex="-1"
            title={iconOnly && option.label ? option.label : undefined}
          >
            {option.icon && (
              <Icon name={option.icon} size="none" class="segment-icon" aria-hidden="true" />
            )}
            {option.label && !iconOnly && <span class="segment-label">{option.label}</span>}
          </span>
        </label>
      ))
    }
  </div>
</fieldset>
