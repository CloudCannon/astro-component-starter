---
import CustomSection from "@builders/custom-section/CustomSection.astro";
import Heading from "@core-elements/heading/Heading.astro";
import SimpleText from "@core-elements/simple-text/SimpleText.astro";
import EventCalendarView from "./EventCalendarView.astro";
import EventListView from "./EventListView.astro";

const {
  eyebrow = "",
  heading = "Upcoming Events",
  subtext = "",
  defaultView = "list",
  maxEventsToShow = 0,
  colorScheme,
  backgroundColor,
  paddingVertical = "4xl",
  class: className,
} = Astro.props;

const uniqueId = crypto.randomUUID();
---

<CustomSection
  class:list={["events-section", className]}
  maxContentWidth="2xl"
  paddingHorizontal="lg"
  paddingVertical={paddingVertical}
  colorScheme={colorScheme}
  backgroundColor={backgroundColor}
>
  {
    eyebrow && (
      <SimpleText alignX="center" class="eyebrow" data-prop="eyebrow">
        {eyebrow}
      </SimpleText>
    )
  }
  <Heading level="h2" size="lg" alignX="center" data-prop="heading">
    {heading}
  </Heading>
  {
    subtext && (
      <SimpleText class="events-subtext" alignX="center" data-prop="subtext">
        {subtext}
      </SimpleText>
    )
  }

  <div class="view-toggle" data-uid={uniqueId}>
    <input
      type="radio"
      name={`view-${uniqueId}`}
      id={`list-${uniqueId}`}
      value="list"
      checked={defaultView === "list"}
      class="view-input"
    />
    <input
      type="radio"
      name={`view-${uniqueId}`}
      id={`calendar-${uniqueId}`}
      value="calendar"
      checked={defaultView === "calendar"}
      class="view-input"
    />

    <div class="toggle-buttons">
      <label for={`list-${uniqueId}`} class="toggle-btn">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="toggle-icon"
        >
          <line x1="8" y1="6" x2="21" y2="6"></line>
          <line x1="8" y1="12" x2="21" y2="12"></line>
          <line x1="8" y1="18" x2="21" y2="18"></line>
          <line x1="3" y1="6" x2="3.01" y2="6"></line>
          <line x1="3" y1="12" x2="3.01" y2="12"></line>
          <line x1="3" y1="18" x2="3.01" y2="18"></line>
        </svg>
        <span>List</span>
      </label>
      <label for={`calendar-${uniqueId}`} class="toggle-btn">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="toggle-icon"
        >
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <span>Calendar</span>
      </label>
    </div>

    <div class="views-container">
      <div class="view list-view">
        <EventListView maxEventsToShow={maxEventsToShow} />
      </div>
      <div class="view calendar-view">
        <EventCalendarView />
      </div>
    </div>
  </div>
</CustomSection>

<style lang="pcss">
  .events-section {
    .eyebrow {
      color: var(--color-text-muted);
      font-size: var(--font-size-sm);
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: var(--spacing-xs);
    }

    .events-subtext {
      color: var(--color-text-muted);
      margin-top: var(--spacing-sm);
      max-width: 40rem;
      margin-inline: auto;
    }

    .view-toggle {
      margin-top: var(--spacing-xl);
    }

    .view-input {
      display: none;
    }

    .toggle-buttons {
      display: flex;
      justify-content: center;
      gap: var(--spacing-xs);
      margin-bottom: var(--spacing-xl);
    }

    .toggle-btn {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: var(--spacing-sm) var(--spacing-lg);
      font-size: var(--font-size-sm);
      font-weight: 600;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      background: var(--color-bg);
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all 0.15s ease;

      &:hover {
        border-color: var(--color-navy);
        color: var(--color-navy);
      }
    }

    .toggle-icon {
      width: 18px;
      height: 18px;
    }



    .views-container {
      position: relative;
    }

    .view {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Show list view when list radio is checked */
    .view-input[value="list"]:checked ~ .views-container .list-view {
      display: block;
    }

    /* Show calendar view when calendar radio is checked */
    .view-input[value="calendar"]:checked ~ .views-container .calendar-view {
      display: block;
    }
  }
</style>

<style is:global lang="pcss">
  .events-section {
    /* List view active state */
    .view-input[value="list"]:checked ~ .toggle-buttons .toggle-btn:first-child {
      background: var(--color-navy);
      border-color: var(--color-navy);
      color: var(--white, #fff);
    }

    /* Calendar view active state */
    .view-input[value="calendar"]:checked ~ .toggle-buttons .toggle-btn:last-child {
      background: var(--color-navy);
      border-color: var(--color-navy);
      color: var(--white, #fff);
    }
  }
</style>
